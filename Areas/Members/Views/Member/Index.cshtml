@* @model FINTCS.Areas.Members.Models.Member *@
@model FINTCS.Areas.Members.Models.Member
@{
    ViewData["Title"] = "Member";
    var step = ViewBag.Step ?? 1;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

<div class="container mt-4">
    <form asp-area="Members" asp-controller="Member" asp-action="Index" method="post" enctype="multipart/form-data">
        <input type="hidden" asp-for="Id" />

        <!-- Tabs -->
        <ul class="nav nav-tabs mb-3" id="memberTabs" role="tablist">
            <li class="nav-item">
                <button type="button" class="nav-link @(step == 1 ? "active" : "")" data-bs-toggle="tab" data-bs-target="#tab1">General</button>
            </li>
            <li class="nav-item">
                <button type="button" class="nav-link @(step == 2 ? "active" : "") @(step < 2 ? "disabled" : "")" data-bs-toggle="tab" data-bs-target="#tab2">Photo & Opening Balance</button>
            </li>
            <li class="nav-item">
                <button type="button" class="nav-link @(step == 3 ? "active" : "") @(step < 3 ? "disabled" : "")" data-bs-toggle="tab" data-bs-target="#tab3">Monthly Deduction</button>
            </li>
        </ul>

        <div class="tab-content">

            <!-- TAB 1 -->
            <div class="tab-pane fade @(step == 1 ? "show active" : "")" id="tab1">
                <div class="card p-3 mb-3" style="background:#e3f2fd;">
                    <h5 class="text-primary fw-bold mb-3">General</h5>
                    <div class="row g-3">

                        <div class="col-md-6"><label>Mem.No.</label><input asp-for="Memno" class="form-control" /></div>

                        <div class="col-md-6"><label>Name</label><input asp-for="Name" class="form-control" /></div>
                        <div class="col-md-6"><label>Father Name</label><input asp-for="FatherName" class="form-control" /></div>
                        <div class="col-md-6"><label>Office Address</label><textarea asp-for="OfficeAddress" class="form-control" rows="3"></textarea></div>
                        <div class="col-md-6"><label>City</label><input asp-for="City" class="form-control" /></div>
                        <div class="col-md-6"><label>Phone</label><input asp-for="Phone" class="form-control" /></div>
                        <div class="col-md-6"><label>Branch</label><input asp-for="Branch" class="form-control" /></div>
                        <div class="col-md-6"><label>Designation</label><input asp-for="Designation" class="form-control" /></div>
                        <div class="col-md-6"><label>Mobile1</label><input asp-for="Mobile1" class="form-control" /></div>
                        <div class="col-md-6"><label>Mobile2</label><input asp-for="Mobile2" class="form-control" /></div>
                        <div class="col-md-6"><label>Residence Address</label><textarea asp-for="ResidenceAddress" class="form-control" rows="3"></textarea></div>
                        <div class="col-md-6"><label>DOB</label><input asp-for="DOB" type="date" class="form-control" /></div>
                        <div class="col-md-6"><label>DOJ Society</label><input asp-for="DOJSociety" type="date" class="form-control" /></div>
                        <div class="col-md-6"><label>Email</label><input asp-for="Email" class="form-control" /></div>
                        <div class="col-md-6"><label>DOJ</label><input asp-for="DOJ" type="date" class="form-control" /></div>
                        <div class="col-md-6"><label>DOR</label><input asp-for="DOR" type="date" class="form-control" /></div>
                        <div class="col-md-6"><label>Nominee</label><input asp-for="Nominee" class="form-control" /></div>
                        <div class="col-md-6"><label>Nominee Relation</label><input asp-for="NomineeRelation" class="form-control" /></div>
                    </div>
                    <div class="text-end mt-3">
                        <button type="submit" name="step" value="1" class="btn btn-primary">Save & Next</button>
                    </div>
                </div>
            </div>

            <!-- TAB 2 -->
            <div class="tab-pane fade @(step == 2 ? "show active" : "")" id="tab2">
                <div class="card p-3 mb-3" style="background:#e8f5e9;">
                    <h5 class="text-success fw-bold mb-3">Photo & Opening Balance</h5>
                    <div class="row g-3">
                        <div class="col-md-6"><label>Share</label><input asp-for="Share" class="form-control" /></div>
                        <div class="col-md-6"><label>CD</label><input asp-for="CD" class="form-control" /></div>
                        <div class="col-md-6"><label>Bank Name</label><input asp-for="BankName" class="form-control" /></div>
                        <div class="col-md-6"><label>Payable At</label><input asp-for="PayableAt" class="form-control" /></div>
                        <div class="col-md-6"><label>Account No.</label><input asp-for="AccountNo" class="form-control" /></div>
                    </div>
                    <div class="row g-3 mt-3">
                        <div class="col-md-6">
                            <label>Photo</label>
                            <input type="file" name="PhotoFile" id="PhotoFile" class="form-control" />
                            <img id="photoPreview" src="@Model.PhotoPath" class="img-thumbnail mt-2" style="max-height:150px;" />
                        </div>

                        <div class="col-md-6">
                            <label>Signature</label>
                            <input type="file" name="SignatureFile" id="SignatureFile" class="form-control" />
                            <img id="signPreview" src="@Model.SignaturePath" class="img-thumbnail mt-2" style="max-height:150px;" />
                        </div>
                    </div>

                    <div class="text-end mt-3">
                        <button type="submit" name="step" value="2" class="btn btn-warning">Save & Next</button>
                    </div>
                </div>
            </div>

            <!-- TAB 3 -->
            <div class="tab-pane fade @(step == 3 ? "show active" : "")" id="tab3">
                <div class="card p-3" style="background:#fff3e0;">
                    <h5 class="text-warning fw-bold mb-3">Monthly Deduction</h5>
                    <div class="row g-3">
                        <div class="col-md-6"><label>Deduction Share</label><input asp-for="DeductionShare" class="form-control" /></div>
                        <div class="col-md-6"><label>WithDrawl</label><input asp-for="WithDrawl" class="form-control" /></div>
                        <div class="col-md-6"><label>G Loan Instalment</label><input asp-for="GLoanInstalment" class="form-control" /></div>
                        <div class="col-md-6"><label>E Loan Instalment</label><input asp-for="ELoanInstalment" class="form-control" /></div>
                    </div>
                    <div class="text-end mt-3">
                        <button type="submit" name="step" value="3" class="btn btn-success px-4">Final Save</button>
                    </div>
                </div>
            </div>

        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    // Activate current tab after post
    var step = @step;
    document.querySelectorAll('#memberTabs button').forEach((btn, index) => {
        // Enable only current step and previous steps
        if (index + 1 <= step) btn.classList.remove('disabled');
        else btn.classList.add('disabled');
    });

    // Show current tab
    var tabEl = document.querySelector(`#memberTabs button:nth-child(${step})`);
    if (tabEl) {
        var tab = new bootstrap.Tab(tabEl);
        tab.show();
    }
    
    $(document).ready(function () {

        // ✅ PHOTO PREVIEW
        $("#PhotoFile").change(function () {
            var input = this;

            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#photoPreview").attr("src", e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        });

        // ✅ SIGNATURE PREVIEW
        $("#SignatureFile").change(function () {
            var input = this;

            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#signPreview").attr("src", e.target.result);
                };
                reader.readAsDataURL(input.files[0]);
            }
        });

    });

</script>
